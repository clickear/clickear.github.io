<!DOCTYPE html>
<html><head><title>ziplist</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="ziplist"/><meta property="og:description" content="#redis/æ•°æ®ç»“æ„ ziplist Â§ ziplistçš„è¿‡æ¸¡ğŸ’¡ åœ¨redisä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†ziplistã€‚ åœ¨è®¾è®¡ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œé¦–å…ˆè¦åšçš„æ˜¯æ˜ç¡®éœ€æ±‚ï¼Œå³ä¼šæ€ä¹ˆè¿›è¡Œæ“ä½œã€‚ åœ¨redisçš„listæ•°æ®ç±»å‹ä¸­ï¼Œä¼šä½¿ç”¨ lpush,rpushç­‰å‘½ä»¤ï¼Œå³éœ€è¦å¤´å°¾è¿›è¡Œæ’å…¥ã€‚ æ‰€ä»¥è‡³å°‘éœ€è¦æ”¯æŒ æ­£å‘éå† é€†å‘éå† å¿«é€Ÿå®šä½å¤´éƒ¨å’Œå°¾éƒ¨ã€‚ æ–¹æ¡ˆ1ï¼ŒåŒå‘é“¾è¡¨ Â§ { *data *pre; -- 8å­—èŠ‚ *next -- 8å­—èŠ‚ }struct node ä¼˜ç‚¹: æ”¯æŒæ­£é€†å‘éå†ï¼ŒO(1)å®šä½å¤´å°¾éƒ¨ ç¼ºç‚¹ï¼š ä¸ç®¡dataçš„å†…å®¹å¤šå¤§ï¼Œéƒ½éœ€è¦è‡³å°‘16å­—èŠ‚çš„preå’ŒnextæŒ‡é’ˆã€‚æµªè´¹å†…å­˜ æ— æ³•ç²¾ç»†åŒ–å¤„ç†å­˜å‚¨ç©ºé—´ ziplist(å¯å˜é•¿æ•°ç»„) Â§ ziplistå°±æ˜¯ä¸ºäº†è§£å†³åŒå‘é“¾è¡¨å¯¹æµªè´¹å†…å­˜çš„æƒ…å†µã€‚ åˆ†æˆ3éƒ¨åˆ†ï¼Œ head data tail headï¼Œä½œä¸ºå…ƒæ•°æ®ã€‚ æ€»å­—èŠ‚æ•° æœ€åä¸€ä¸ªå…ƒç´ åç§»é‡ï¼Œä¸ºäº†å¿«é€Ÿå®šä½æœ€åä¸€ä¸ªèŠ‚ç‚¹æ•°æ® ziplistå…ƒç´ æ•°é‡ï¼Œå¿«é€Ÿè·å–entryæ€»é‡ entry, å­˜å‚¨æ•°æ®æ•°ç»„ã€‚ pre_len, å­˜å‚¨ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ã€‚æ˜¯ä¸ºäº†é€†å‘éå†æ—¶ï¼Œkeyæ‰¾åˆ°ä¸Šä¸€ä¸ªentry pren_lensize,æ˜¯æŒ‡å­˜å‚¨pre_lenæ‰€å ç”¨çš„å­—èŠ‚ã€‚ æ¯”å¦‚ï¼Œä¸Šä¸€ä¸ªentryé•¿åº¦åªæœ‰254æ—¶ï¼Œæ²¡å¿…è¦ç”³è¯·å¤ªå¤§çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨é•¿åº¦ pre_len&amp;lt;254, å ç”¨1ä¸ªå­—èŠ‚ pre_len&amp;gt;=254, å ç”¨5ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚å›ºå®šå€¼æ˜¯254 encoding,å½“å‰entryé•¿åº¦ç¼–ç ã€‚ä¸»è¦æ˜¯ä¸ºäº†é€‚é…ä¸åŒçš„dataç±»å‹ï¼Œä½¿ç”¨ä¸åŒçš„ç¼–ç ã€‚ data: çœŸå®æ•°æ® ä¼˜ç‚¹: å ç”¨ç´§å‡‘ï¼Œå°½å¯èƒ½çš„ç²¾ç»†åŒ–æ§åˆ¶å†…å­˜å ç”¨ã€‚æ ¹æ®ä¸Šä¸€ä¸ªentryé•¿åº¦å’Œå½“å‰entryé•¿åº¦ï¼Œä½¿ç”¨ä¸åŒçš„ç©ºé—´åœ¨å­˜å‚¨ã€‚ æ”¯æŒæ­£å‘éå†è¿‡ç¨‹ headæ˜¯å›ºå®šå­—èŠ‚æ•°ï¼Œè·³è¿‡headçš„å¤§å°ï¼Œå®šä½åˆ°ç¬¬ä¸€ä¸ªentry è®¡ç®—å‡ºentryçš„å ç”¨çš„å­—èŠ‚æ•° æ ¹æ®pren_lençš„å€¼ï¼Œè®¡ç®—å‡ºpren_lensizeå ç”¨å¤§å° æ ¹æ®encoding,è®¡ç®—å‡ºencodingå’Œdataçš„å ç”¨å¤§å°ã€‚ è·³è¿‡entryçš„å ç”¨å­—èŠ‚æ•°ï¼Œè·³è½¬åˆ°nextEntry é€†å‘éå†è¿‡ç¨‹ æ ¹æ®headç§çš„æœ€åä¸€ä¸ªå…ƒç´ åç§»é‡ï¼Œå®šä½åˆ°æœ€åä¸€ä¸ªentry è·å–entryä¸­çš„pren_len è·³è¿‡pren_lenï¼Œå³å¯æ‰¾åˆ°å‰ä¸€ä¸ªentry ç¼ºç‚¹: éå†è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼Œæ‰€ä»¥å¦‚æœå…ƒç´ æ•°é‡å¤ªå¤šï¼Œä¼šå¯¼è‡´æ€§èƒ½å¤ªæ…¢ã€‚ ç”±äºentryä¸­çš„pre_lenï¼Œå­˜å‚¨çš„æ˜¯ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ï¼Œå¹¶ä¸”å¯èƒ½å ç”¨çš„å†…å­˜æ˜¯1ä¸ªå­—èŠ‚æˆ–è€…5ä¸ªå­—èŠ‚ã€‚å¦‚æœä¸­é—´æŸä¸ªentryçš„å†…å®¹å‘é€å˜åŒ–ï¼Œå¯¼è‡´åç»­çš„entryé•¿åº¦å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šå¯¼è‡´ çº§è”æ›´æ–° quicklist(é“¾è¡¨ + ziplist) Â§ å› ä¸ºziplistä¸­çš„entry,å­˜å‚¨çš„æ˜¯ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ï¼Œå¯¼è‡´äº†çº§è”æ›´æ–°é—®é¢˜ã€‚ quicklist çš„è®¾è®¡ï¼Œå…¶å®æ˜¯ç»“åˆäº†é“¾è¡¨å’Œ ziplist å„è‡ªçš„ä¼˜åŠ¿ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª quicklist å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ª ziplist åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå‡ºç°ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™è¿›è¡Œåˆ›å»ºæ–°çš„quicklistNode å•ä¸ª ziplist æ˜¯å¦ä¸è¶…è¿‡ 8KBï¼Œ å•ä¸ª ziplist é‡Œçš„å…ƒç´ ä¸ªæ•°æ˜¯å¦æ»¡è¶³è¦æ±‚ è¿™æ ·ä¸€æ¥ï¼Œquicklist é€šè¿‡æ§åˆ¶æ¯ä¸ª quicklistNode ä¸­ï¼Œziplist çš„å¤§å°æˆ–æ˜¯å…ƒç´ ä¸ªæ•°ï¼Œå°±æœ‰æ•ˆå‡å°‘äº†åœ¨ ziplist ä¸­æ–°å¢æˆ–ä¿®æ”¹å…ƒç´ åï¼Œå‘ç”Ÿè¿é”æ›´æ–°çš„æƒ…å†µï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„è®¿é—®æ€§èƒ½."/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="#redis/æ•°æ®ç»“æ„ ziplist Â§ ziplistçš„è¿‡æ¸¡ğŸ’¡ åœ¨redisä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†ziplistã€‚ åœ¨è®¾è®¡ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œé¦–å…ˆè¦åšçš„æ˜¯æ˜ç¡®éœ€æ±‚ï¼Œå³ä¼šæ€ä¹ˆè¿›è¡Œæ“ä½œã€‚ åœ¨redisçš„listæ•°æ®ç±»å‹ä¸­ï¼Œä¼šä½¿ç”¨ lpush,rpushç­‰å‘½ä»¤ï¼Œå³éœ€è¦å¤´å°¾è¿›è¡Œæ’å…¥ã€‚ æ‰€ä»¥è‡³å°‘éœ€è¦æ”¯æŒ æ­£å‘éå† é€†å‘éå† å¿«é€Ÿå®šä½å¤´éƒ¨å’Œå°¾éƒ¨ã€‚ æ–¹æ¡ˆ1ï¼ŒåŒå‘é“¾è¡¨ Â§ { *data *pre; -- 8å­—èŠ‚ *next -- 8å­—èŠ‚ }struct node ä¼˜ç‚¹: æ”¯æŒæ­£é€†å‘éå†ï¼ŒO(1)å®šä½å¤´å°¾éƒ¨ ç¼ºç‚¹ï¼š ä¸ç®¡dataçš„å†…å®¹å¤šå¤§ï¼Œéƒ½éœ€è¦è‡³å°‘16å­—èŠ‚çš„preå’ŒnextæŒ‡é’ˆã€‚æµªè´¹å†…å­˜ æ— æ³•ç²¾ç»†åŒ–å¤„ç†å­˜å‚¨ç©ºé—´ ziplist(å¯å˜é•¿æ•°ç»„) Â§ ziplistå°±æ˜¯ä¸ºäº†è§£å†³åŒå‘é“¾è¡¨å¯¹æµªè´¹å†…å­˜çš„æƒ…å†µã€‚ åˆ†æˆ3éƒ¨åˆ†ï¼Œ head data tail headï¼Œä½œä¸ºå…ƒæ•°æ®ã€‚ æ€»å­—èŠ‚æ•° æœ€åä¸€ä¸ªå…ƒç´ åç§»é‡ï¼Œä¸ºäº†å¿«é€Ÿå®šä½æœ€åä¸€ä¸ªèŠ‚ç‚¹æ•°æ® ziplistå…ƒç´ æ•°é‡ï¼Œå¿«é€Ÿè·å–entryæ€»é‡ entry, å­˜å‚¨æ•°æ®æ•°ç»„ã€‚ pre_len, å­˜å‚¨ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ã€‚æ˜¯ä¸ºäº†é€†å‘éå†æ—¶ï¼Œkeyæ‰¾åˆ°ä¸Šä¸€ä¸ªentry pren_lensize,æ˜¯æŒ‡å­˜å‚¨pre_lenæ‰€å ç”¨çš„å­—èŠ‚ã€‚ æ¯”å¦‚ï¼Œä¸Šä¸€ä¸ªentryé•¿åº¦åªæœ‰254æ—¶ï¼Œæ²¡å¿…è¦ç”³è¯·å¤ªå¤§çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨é•¿åº¦ pre_len&amp;lt;254, å ç”¨1ä¸ªå­—èŠ‚ pre_len&amp;gt;=254, å ç”¨5ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚å›ºå®šå€¼æ˜¯254 encoding,å½“å‰entryé•¿åº¦ç¼–ç ã€‚ä¸»è¦æ˜¯ä¸ºäº†é€‚é…ä¸åŒçš„dataç±»å‹ï¼Œä½¿ç”¨ä¸åŒçš„ç¼–ç ã€‚ data: çœŸå®æ•°æ® ä¼˜ç‚¹: å ç”¨ç´§å‡‘ï¼Œå°½å¯èƒ½çš„ç²¾ç»†åŒ–æ§åˆ¶å†…å­˜å ç”¨ã€‚æ ¹æ®ä¸Šä¸€ä¸ªentryé•¿åº¦å’Œå½“å‰entryé•¿åº¦ï¼Œä½¿ç”¨ä¸åŒçš„ç©ºé—´åœ¨å­˜å‚¨ã€‚ æ”¯æŒæ­£å‘éå†è¿‡ç¨‹ headæ˜¯å›ºå®šå­—èŠ‚æ•°ï¼Œè·³è¿‡headçš„å¤§å°ï¼Œå®šä½åˆ°ç¬¬ä¸€ä¸ªentry è®¡ç®—å‡ºentryçš„å ç”¨çš„å­—èŠ‚æ•° æ ¹æ®pren_lençš„å€¼ï¼Œè®¡ç®—å‡ºpren_lensizeå ç”¨å¤§å° æ ¹æ®encoding,è®¡ç®—å‡ºencodingå’Œdataçš„å ç”¨å¤§å°ã€‚ è·³è¿‡entryçš„å ç”¨å­—èŠ‚æ•°ï¼Œè·³è½¬åˆ°nextEntry é€†å‘éå†è¿‡ç¨‹ æ ¹æ®headç§çš„æœ€åä¸€ä¸ªå…ƒç´ åç§»é‡ï¼Œå®šä½åˆ°æœ€åä¸€ä¸ªentry è·å–entryä¸­çš„pren_len è·³è¿‡pren_lenï¼Œå³å¯æ‰¾åˆ°å‰ä¸€ä¸ªentry ç¼ºç‚¹: éå†è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼Œæ‰€ä»¥å¦‚æœå…ƒç´ æ•°é‡å¤ªå¤šï¼Œä¼šå¯¼è‡´æ€§èƒ½å¤ªæ…¢ã€‚ ç”±äºentryä¸­çš„pre_lenï¼Œå­˜å‚¨çš„æ˜¯ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ï¼Œå¹¶ä¸”å¯èƒ½å ç”¨çš„å†…å­˜æ˜¯1ä¸ªå­—èŠ‚æˆ–è€…5ä¸ªå­—èŠ‚ã€‚å¦‚æœä¸­é—´æŸä¸ªentryçš„å†…å®¹å‘é€å˜åŒ–ï¼Œå¯¼è‡´åç»­çš„entryé•¿åº¦å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šå¯¼è‡´ çº§è”æ›´æ–° quicklist(é“¾è¡¨ + ziplist) Â§ å› ä¸ºziplistä¸­çš„entry,å­˜å‚¨çš„æ˜¯ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ï¼Œå¯¼è‡´äº†çº§è”æ›´æ–°é—®é¢˜ã€‚ quicklist çš„è®¾è®¡ï¼Œå…¶å®æ˜¯ç»“åˆäº†é“¾è¡¨å’Œ ziplist å„è‡ªçš„ä¼˜åŠ¿ã€‚ç®€å•æ¥è¯´ï¼Œä¸€ä¸ª quicklist å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ª ziplist åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå‡ºç°ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™è¿›è¡Œåˆ›å»ºæ–°çš„quicklistNode å•ä¸ª ziplist æ˜¯å¦ä¸è¶…è¿‡ 8KBï¼Œ å•ä¸ª ziplist é‡Œçš„å…ƒç´ ä¸ªæ•°æ˜¯å¦æ»¡è¶³è¦æ±‚ è¿™æ ·ä¸€æ¥ï¼Œquicklist é€šè¿‡æ§åˆ¶æ¯ä¸ª quicklistNode ä¸­ï¼Œziplist çš„å¤§å°æˆ–æ˜¯å…ƒç´ ä¸ªæ•°ï¼Œå°±æœ‰æ•ˆå‡å°‘äº†åœ¨ ziplist ä¸­æ–°å¢æˆ–ä¿®æ”¹å…ƒç´ åï¼Œå‘ç”Ÿè¿é”æ›´æ–°çš„æƒ…å†µï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„è®¿é—®æ€§èƒ½."/><meta name="generator" content="Quartz"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch(`./static/contentIndex.json`).then(data => data.json())</script></head><body data-slug="ziplist"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href=".">ğŸª´ Quartz 4.0</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabIndex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="results-container"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabIndex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xmlSpace="preserve"><title>Light mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xmlSpace="preserve"><title>Dark mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="toc desktop-only"><button type="button" id="toc"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#ziplist" data-for="ziplist">ziplist</a></li><li class="depth-2"><a href="#æ–¹æ¡ˆ1åŒå‘é“¾è¡¨" data-for="æ–¹æ¡ˆ1åŒå‘é“¾è¡¨">æ–¹æ¡ˆ1ï¼ŒåŒå‘é“¾è¡¨</a></li><li class="depth-2"><a href="#ziplistå¯å˜é•¿æ•°ç»„" data-for="ziplistå¯å˜é•¿æ•°ç»„">ziplist(å¯å˜é•¿æ•°ç»„)</a></li><li class="depth-2"><a href="#quicklisté“¾è¡¨--ziplist" data-for="quicklisté“¾è¡¨--ziplist">quicklist(é“¾è¡¨ + ziplist)</a></li><li class="depth-2"><a href="#listpackziplistçš„å˜ç§å­˜å‚¨å½“å‰entryé•¿åº¦" data-for="listpackziplistçš„å˜ç§å­˜å‚¨å½“å‰entryé•¿åº¦">listpack(ziplistçš„å˜ç§ï¼Œå­˜å‚¨å½“å‰entryé•¿åº¦)</a></li><li class="depth-2"><a href="#åå‘æŸ¥è¯¢" data-for="åå‘æŸ¥è¯¢">åå‘æŸ¥è¯¢</a></li><li class="depth-1"><a href="#èµ„æ–™" data-for="èµ„æ–™">èµ„æ–™</a></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><h1 class="article-title">ziplist</h1><p class="content-meta">Nov 14, 2023, 10 min read</p><ul class="tags"><li><a href="./tags/redis/æ•°æ®ç»“æ„" class="internal tag-link">#redis/æ•°æ®ç»“æ„</a></li></ul></div></div><article class="popover-hint"><p><a href="./tags/redis/æ•°æ®ç»“æ„" class="tag-link internal">#redis/æ•°æ®ç»“æ„</a></p>
<h1 id="ziplist">ziplist<a aria-hidden="true" tabindex="-1" href="#ziplist" class="internal"> Â§</a></h1>
<blockquote class="callout" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div>
                  <div class="callout-title-inner"><p>ziplistçš„è¿‡æ¸¡ğŸ’¡ </p></div>
                  
                </div>
<p>åœ¨redisä¸­ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†ziplistã€‚</p>
</blockquote>
<p>åœ¨è®¾è®¡ä½¿ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œé¦–å…ˆè¦åšçš„æ˜¯æ˜ç¡®éœ€æ±‚ï¼Œå³ä¼šæ€ä¹ˆè¿›è¡Œæ“ä½œã€‚<br/>
åœ¨redisçš„listæ•°æ®ç±»å‹ä¸­ï¼Œä¼šä½¿ç”¨ lpush,rpushç­‰å‘½ä»¤ï¼Œå³éœ€è¦å¤´å°¾è¿›è¡Œæ’å…¥ã€‚<br/>
æ‰€ä»¥è‡³å°‘éœ€è¦æ”¯æŒ</p>
<ul>
<li>æ­£å‘éå†</li>
<li>é€†å‘éå†</li>
<li>å¿«é€Ÿå®šä½å¤´éƒ¨å’Œå°¾éƒ¨ã€‚</li>
</ul>
<h3 id="æ–¹æ¡ˆ1åŒå‘é“¾è¡¨">æ–¹æ¡ˆ1ï¼ŒåŒå‘é“¾è¡¨<a aria-hidden="true" tabindex="-1" href="#æ–¹æ¡ˆ1åŒå‘é“¾è¡¨" class="internal"> Â§</a></h3>
<pre><code>{
   *data
   *pre;  -- 8å­—èŠ‚
   *next  -- 8å­—èŠ‚

}struct node
</code></pre>
<p>ä¼˜ç‚¹:<br/>
æ”¯æŒæ­£é€†å‘éå†ï¼ŒO(1)å®šä½å¤´å°¾éƒ¨</p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>ä¸ç®¡dataçš„å†…å®¹å¤šå¤§ï¼Œéƒ½éœ€è¦è‡³å°‘16å­—èŠ‚çš„preå’ŒnextæŒ‡é’ˆã€‚æµªè´¹å†…å­˜</li>
<li>æ— æ³•ç²¾ç»†åŒ–å¤„ç†å­˜å‚¨ç©ºé—´</li>
</ol>
<h3 id="ziplistå¯å˜é•¿æ•°ç»„">ziplist(å¯å˜é•¿æ•°ç»„)<a aria-hidden="true" tabindex="-1" href="#ziplistå¯å˜é•¿æ•°ç»„" class="internal"> Â§</a></h3>
<p>ziplistå°±æ˜¯ä¸ºäº†è§£å†³åŒå‘é“¾è¡¨å¯¹æµªè´¹å†…å­˜çš„æƒ…å†µã€‚<br/>
åˆ†æˆ3éƒ¨åˆ†ï¼Œ head data tail</p>
<ul>
<li>
<p>headï¼Œä½œä¸ºå…ƒæ•°æ®ã€‚</p>
<ul>
<li>æ€»å­—èŠ‚æ•°</li>
<li>æœ€åä¸€ä¸ªå…ƒç´ åç§»é‡ï¼Œä¸ºäº†å¿«é€Ÿå®šä½æœ€åä¸€ä¸ªèŠ‚ç‚¹æ•°æ®</li>
<li>ziplistå…ƒç´ æ•°é‡ï¼Œå¿«é€Ÿè·å–entryæ€»é‡</li>
</ul>
</li>
<li>
<p>entry, å­˜å‚¨æ•°æ®æ•°ç»„ã€‚</p>
<ul>
<li>pre_len, å­˜å‚¨ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ã€‚æ˜¯ä¸ºäº†é€†å‘éå†æ—¶ï¼Œkeyæ‰¾åˆ°ä¸Šä¸€ä¸ªentry
<ul>
<li>pren_lensize,æ˜¯æŒ‡å­˜å‚¨pre_lenæ‰€å ç”¨çš„å­—èŠ‚ã€‚
<ul>
<li>æ¯”å¦‚ï¼Œä¸Šä¸€ä¸ªentryé•¿åº¦åªæœ‰254æ—¶ï¼Œæ²¡å¿…è¦ç”³è¯·å¤ªå¤§çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨é•¿åº¦</li>
<li>pre_len&lt;254, å ç”¨1ä¸ªå­—èŠ‚</li>
<li>pre_len>=254, å ç”¨5ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚å›ºå®šå€¼æ˜¯254</li>
</ul>
</li>
</ul>
</li>
<li>encoding,å½“å‰entryé•¿åº¦ç¼–ç ã€‚ä¸»è¦æ˜¯ä¸ºäº†é€‚é…ä¸åŒçš„dataç±»å‹ï¼Œä½¿ç”¨ä¸åŒçš„ç¼–ç ã€‚</li>
<li>data: çœŸå®æ•°æ®<br/>
ä¼˜ç‚¹:</li>
</ul>
</li>
<li>
<p>å ç”¨ç´§å‡‘ï¼Œå°½å¯èƒ½çš„ç²¾ç»†åŒ–æ§åˆ¶å†…å­˜å ç”¨ã€‚æ ¹æ®ä¸Šä¸€ä¸ªentryé•¿åº¦å’Œå½“å‰entryé•¿åº¦ï¼Œä½¿ç”¨ä¸åŒçš„ç©ºé—´åœ¨å­˜å‚¨ã€‚</p>
</li>
<li>
<p>æ”¯æŒæ­£å‘éå†è¿‡ç¨‹</p>
<ul>
<li>headæ˜¯å›ºå®šå­—èŠ‚æ•°ï¼Œè·³è¿‡headçš„å¤§å°ï¼Œå®šä½åˆ°ç¬¬ä¸€ä¸ªentry</li>
<li>è®¡ç®—å‡ºentryçš„å ç”¨çš„å­—èŠ‚æ•°
<ul>
<li>æ ¹æ®pren_lençš„å€¼ï¼Œè®¡ç®—å‡ºpren_lensizeå ç”¨å¤§å°</li>
<li>æ ¹æ®encoding,è®¡ç®—å‡ºencodingå’Œdataçš„å ç”¨å¤§å°ã€‚</li>
</ul>
</li>
<li>è·³è¿‡entryçš„å ç”¨å­—èŠ‚æ•°ï¼Œè·³è½¬åˆ°nextEntry</li>
</ul>
</li>
<li>
<p>é€†å‘éå†è¿‡ç¨‹</p>
<ul>
<li>æ ¹æ®headç§çš„æœ€åä¸€ä¸ªå…ƒç´ åç§»é‡ï¼Œå®šä½åˆ°æœ€åä¸€ä¸ªentry</li>
<li>è·å–entryä¸­çš„pren_len</li>
<li>è·³è¿‡pren_lenï¼Œå³å¯æ‰¾åˆ°å‰ä¸€ä¸ªentry</li>
</ul>
</li>
</ul>
<p>ç¼ºç‚¹:</p>
<ol>
<li>éå†è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼Œæ‰€ä»¥å¦‚æœå…ƒç´ æ•°é‡å¤ªå¤šï¼Œä¼šå¯¼è‡´æ€§èƒ½å¤ªæ…¢ã€‚</li>
<li>ç”±äºentryä¸­çš„pre_lenï¼Œå­˜å‚¨çš„æ˜¯ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ï¼Œå¹¶ä¸”å¯èƒ½å ç”¨çš„å†…å­˜æ˜¯1ä¸ªå­—èŠ‚æˆ–è€…5ä¸ªå­—èŠ‚ã€‚å¦‚æœä¸­é—´æŸä¸ªentryçš„å†…å®¹å‘é€å˜åŒ–ï¼Œå¯¼è‡´åç»­çš„entryé•¿åº¦å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šå¯¼è‡´ <strong>çº§è”æ›´æ–°</strong><br/>
<img src="http://image.clickear.top/20231018102201.png" alt="image.png"/></li>
</ol>
<h3 id="quicklisté“¾è¡¨--ziplist">quicklist(é“¾è¡¨ + ziplist)<a aria-hidden="true" tabindex="-1" href="#quicklisté“¾è¡¨--ziplist" class="internal"> Â§</a></h3>
<p>å› ä¸ºziplistä¸­çš„entry,å­˜å‚¨çš„æ˜¯ä¸Šä¸€ä¸ªentryçš„é•¿åº¦ï¼Œå¯¼è‡´äº†çº§è”æ›´æ–°é—®é¢˜ã€‚<br/>
quicklist çš„è®¾è®¡ï¼Œå…¶å®æ˜¯ç»“åˆäº†é“¾è¡¨å’Œ ziplist å„è‡ªçš„ä¼˜åŠ¿ã€‚ç®€å•æ¥è¯´ï¼Œ<strong>ä¸€ä¸ª quicklist å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åˆæ˜¯ä¸€ä¸ª ziplist</strong></p>
<p><img src="http://image.clickear.top/20231018180804.png" alt="image.png"/></p>
<p>åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå‡ºç°ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™è¿›è¡Œåˆ›å»ºæ–°çš„quicklistNode</p>
<ul>
<li>å•ä¸ª ziplist æ˜¯å¦ä¸è¶…è¿‡ 8KBï¼Œ</li>
<li>å•ä¸ª ziplist é‡Œçš„å…ƒç´ ä¸ªæ•°æ˜¯å¦æ»¡è¶³è¦æ±‚<br/>
è¿™æ ·ä¸€æ¥ï¼Œquicklist é€šè¿‡æ§åˆ¶æ¯ä¸ª quicklistNode ä¸­ï¼Œziplist çš„å¤§å°æˆ–æ˜¯å…ƒç´ ä¸ªæ•°ï¼Œå°±æœ‰æ•ˆå‡å°‘äº†åœ¨ ziplist ä¸­æ–°å¢æˆ–ä¿®æ”¹å…ƒç´ åï¼Œå‘ç”Ÿè¿é”æ›´æ–°çš„æƒ…å†µï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„è®¿é—®æ€§èƒ½.</li>
</ul>
<h3 id="listpackziplistçš„å˜ç§å­˜å‚¨å½“å‰entryé•¿åº¦">listpack(ziplistçš„å˜ç§ï¼Œå­˜å‚¨å½“å‰entryé•¿åº¦)<a aria-hidden="true" tabindex="-1" href="#listpackziplistçš„å˜ç§å­˜å‚¨å½“å‰entryé•¿åº¦" class="internal"> Â§</a></h3>
<blockquote class="callout" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div>
                  <div class="callout-title-inner"><p>ä¸ziplistçš„ä¼˜åŒ–æ€è·¯ğŸ’¡ </p></div>
                  
                </div>
<ol>
<li>ziplistçš„ä¸»è¦é—®é¢˜ï¼Œåœ¨äºå­˜å‚¨äº†pre_lenï¼Œå¯¼è‡´äº†çº§è”æ›´æ–°ã€‚pren_lençš„ä¸»è¦ä½œç”¨ï¼Œåœ¨äºé€†å‘éå†ï¼Œé‚£æœ‰ä»€ä¹ˆåŠæ³•ï¼Œä¸å­˜å‚¨pre_lenï¼Œåˆèƒ½è¿›è¡Œé€†å‘éå†å‘¢ï¼Ÿ<br/>
listpack,é€šè¿‡è®¡ç®—å‡ºå½“å‰entryçš„é•¿åº¦ï¼Œå°±å¯ä»¥å®šä½åˆ°ä¸Šä¸€ä¸ªentryç»“æŸæŒ‡é’ˆã€‚é‚£å¦‚ä½•çŸ¥é“ï¼Œentryçš„é•¿åº¦å‘¢ï¼Ÿä¸»è¦åœ¨äºï¼Œå¯¹entry_lençš„ç‰¹æ®Šå¤„ç†ã€‚å°†æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½bitï¼Œç”¨æ¥åˆ¤æ–­entry-lenæ˜¯å¦ç»“æŸã€‚<br/>
æœ€é«˜ä½0ï¼Œä»£è¡¨entry_lenè¿˜æ²¡ç»“æŸã€‚<br/>
æœ€é«˜ä½1ï¼Œä»£è¡¨entry_lenç»“æŸã€‚<br/>
é€†å‘éå†æ—¶ï¼Œä¾æ¬¡è·å–æœ€åçš„å­—èŠ‚ï¼Œåˆ¤æ–­æœ€é«˜ä½ã€‚çŸ¥é“æœ€é«˜ä½æ˜¯1ï¼Œä»£è¡¨äº†entry_lençš„é•¿åº¦ã€‚å³å¯ç®—å‡ºå½“å‰entry_lençš„é•¿åº¦ã€‚ä»è€Œå®šä½åˆ°å½“å‰entry</li>
</ol>
</blockquote>
<p><img src="http://image.clickear.top/20231018170137.png" alt="image.png"/></p>
<ul>
<li>head å…ƒæ•°æ®
<ul>
<li>æ€»å­—èŠ‚æ•°</li>
<li>å…ƒç´ æ•°é‡</li>
</ul>
</li>
<li>entryåˆ—è¡¨ï¼Œåªå­˜å‚¨å½“å‰entryçš„é•¿åº¦
<ul>
<li>encoding-type: ä¿å­˜äº†<strong>æ•°æ®ç±»å‹åŠæ•°æ®é•¿åº¦</strong></li>
<li>dataï¼š å®é™…æ•°æ®</li>
<li>entry-len:ï¼ˆelement-tot-lenï¼‰ æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ï¼Œæ˜¯ç”¨æ¥è¡¨ç¤ºå½“å‰å­—èŠ‚æ˜¯å¦ä¸º entry-len çš„æœ€åä¸€ä¸ªå­—èŠ‚(ä½ 7 ä½é‡‡ç”¨äº†<strong>å¤§ç«¯æ¨¡å¼å­˜å‚¨</strong>)
<ul>
<li>æœ€é«˜ä½ä¸º 1ï¼Œè¡¨ç¤º entry-len è¿˜æ²¡æœ‰ç»“æŸï¼Œå½“å‰å­—èŠ‚çš„å·¦è¾¹å­—èŠ‚ä»ç„¶è¡¨ç¤º entry-len çš„å†…å®¹ï¼›</li>
<li>æœ€é«˜ä½ä¸º 0ï¼Œè¡¨ç¤ºå½“å‰å­—èŠ‚å·²ç»æ˜¯ entry-len æœ€åä¸€ä¸ªå­—èŠ‚äº†ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>tail: å›ºå®šå€¼ç»“æŸç¬¦:255</li>
</ul>
<p>ä¼˜ç‚¹:</p>
<ul>
<li>ç´§å‡‘å­˜å‚¨ï¼Œè§£å†³äº†<a href="./ziplist" class="internal">ziplist</a>çš„çº§è”æ›´æ–°é—®é¢˜ã€‚é€šè¿‡encoding_typeï¼Œå°½å¯èƒ½æ§åˆ¶å†…å­˜å ç”¨</li>
<li>æ”¯æŒæ­£å‘éå†
<ul>
<li>é¦–å…ˆï¼Œlistpack ä¿å­˜äº† LP_HDR_SIZEï¼Œé€šè¿‡è¯¥å‚æ•°å¯ä»¥ç›´æ¥å°†æŒ‡é’ˆç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ª entry åˆ—è¡¨é¡¹</li>
<li>å…ˆè®¡ç®— encoding + data çš„æ€»é•¿åº¦ len1</li>
<li>é€šè¿‡ len1 å¯è®¡ç®—å‡º element-tot-len çš„é•¿åº¦</li>
<li>len1 + element-tot-len ä¹‹å’Œå³ä¸º entry æ€»é•¿åº¦ total-len</li>
<li>å‘åç§»åŠ¨ total-len å³ä¸ºä¸‹ä¸€ä¸ªåˆ—è¡¨é¡¹çš„èµ·å§‹ä½ç½®</li>
</ul>
</li>
<li>æ”¯æŒé€†å‘éå†ï¼ˆï¼‰
<ul>
<li><strong>element-tot-len</strong>çš„ç‰¹æ®Šç¼–ç æ–¹å¼ï¼šelement-tot-len æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ï¼Œæ˜¯ç”¨æ¥è¡¨ç¤ºå½“å‰å­—èŠ‚æ˜¯å¦ä¸º element-tot-len çš„æœ€åä¸€ä¸ªå­—èŠ‚</li>
<li>ä»å½“å‰åˆ—è¡¨é¡¹èµ·å§‹ä½ç½®çš„æŒ‡é’ˆå¼€å§‹ï¼Œå‘å·¦é€ä¸ªå­—èŠ‚è§£æ(ç¢°åˆ°æœ€é«˜ä½ä¸º1ï¼Œå³ç»“æŸ)ï¼Œå¾—åˆ°å‰ä¸€é¡¹çš„ element-tot-len å€¼ï¼Œä¹Ÿå°±å¯ä»¥å¾—åˆ°encoding + dataçš„æ€»é•¿åº¦ï¼Œä»è€Œå¾—å‡ºentryçš„æ€»é•¿åº¦ï¼›</li>
<li>å‡å»entryçš„æ€»é•¿åº¦ï¼Œå°±å¾—åˆ°äº†å‰ä¸€ä¸ªentryçš„åœ°å€</li>
</ul>
</li>
</ul>
<h3 id="åå‘æŸ¥è¯¢">åå‘æŸ¥è¯¢<a aria-hidden="true" tabindex="-1" href="#åå‘æŸ¥è¯¢" class="internal"> Â§</a></h3>
<p>ä¸ºäº†<strong>æ”¯æŒåå‘æŸ¥è¯¢</strong>ï¼Œç‰¹æ„è®¾è®¡äº†å‚æ•°element-tot-lenï¼Œæ€ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºå¯¹äºæ­£å‘æŸ¥è¯¢ï¼Œencodingä¿å­˜äº†æ•°æ®ç±»å‹åŠæ•°æ®é•¿åº¦ï¼Œå°±å¯ä»¥çŸ¥é“æ•´ä¸ªentryçš„é•¿åº¦</p>
<p><strong>element-tot-len</strong>çš„ç‰¹æ®Šç¼–ç æ–¹å¼ï¼šelement-tot-len æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ï¼Œæ˜¯ç”¨æ¥è¡¨ç¤ºå½“å‰å­—èŠ‚æ˜¯å¦ä¸º element-tot-len çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œå­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>æœ€é«˜ä½ä¸º 1ï¼Œè¡¨ç¤º element-tot-len è¿˜æ²¡æœ‰ç»“æŸï¼Œå½“å‰å­—èŠ‚çš„å·¦è¾¹å­—èŠ‚ä»ç„¶è¡¨ç¤º element-tot-len çš„å†…å®¹ï¼›</li>
<li>æœ€é«˜ä½ä¸º 0ï¼Œè¡¨ç¤ºå½“å‰å­—èŠ‚å·²ç»æ˜¯ element-tot-len æœ€åä¸€ä¸ªå­—èŠ‚äº†ã€‚è€Œ element-tot-len æ¯ä¸ªå­—èŠ‚çš„ä½ 7 ä½ï¼Œåˆ™è®°å½•äº†å®é™…çš„é•¿åº¦ä¿¡æ¯ã€‚</li>
</ul>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œelement-tot-len æ¯ä¸ªå­—èŠ‚çš„ä½ 7 ä½é‡‡ç”¨äº†<strong>å¤§ç«¯æ¨¡å¼å­˜å‚¨</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œentry-len çš„ä½ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜é«˜åœ°å€ä¸Šã€‚</p>
<p>æ­£æ˜¯å› ä¸ºæœ‰äº† element-tot-len çš„ç‰¹åˆ«ç¼–ç æ–¹å¼ï¼ŒlpDecodeBacklen å‡½æ•°å°±å¯ä»¥ä»å½“å‰åˆ—è¡¨é¡¹èµ·å§‹ä½ç½®çš„æŒ‡é’ˆå¼€å§‹ï¼Œå‘å·¦é€ä¸ªå­—èŠ‚è§£æï¼Œå¾—åˆ°å‰ä¸€é¡¹çš„ element-tot-len å€¼ï¼Œä¹Ÿå°±å¯ä»¥å¾—åˆ°encoding + dataçš„æ€»é•¿åº¦ï¼Œä»è€Œå¾—å‡ºentryçš„æ€»é•¿åº¦ï¼›å‡å»entryçš„æ€»é•¿åº¦ï¼Œå°±å¾—åˆ°äº†å‰ä¸€ä¸ªentryçš„åœ°å€ï½</p>
<p>ä½œè€…ï¼šæŸæ²¹<br/>
é“¾æ¥ï¼š<a href="https://juejin.cn/post/7093530299866284045" class="external">7093530299866284045</a><br/>
æ¥æºï¼šç¨€åœŸæ˜é‡‘<br/>
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚<br/>
3. åœ¨æ–°ç‰ˆçš„reidsä¸­ï¼Œå·²ç»å¤§é‡æ›¿æ¢äº†ziplistã€‚<br/>
ç¼ºç‚¹:</p>
<ol>
<li>åŒziplist,å­˜å‚¨å…ƒç´ æ›´å¤§æ—¶ï¼Œè¿›è¡Œéå†æ—¶ä¼šå¯¼è‡´æ€§èƒ½å·®ã€‚</li>
</ol>
<blockquote class="callout" data-callout="tip">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div>
                  <div class="callout-title-inner"><p>æŠ€å·§ğŸ’¡ </p></div>
                  
                </div>
<p>ziplist, listpackéå†æ€§èƒ½å·®çš„é—®é¢˜ï¼Œåªåœ¨å…ƒç´ è¾ƒå°‘æ—¶æ‰ä½¿ç”¨ã€‚å½“å…ƒç´ æ•°é‡å¤ªå¤§æ—¶ï¼Œåº•å±‚çš„æ•°æ®ç»“æ„å°±ä¼šå˜åŒ–ã€‚<br/>
å¦‚zset,åœ¨å…ƒç´ æ•°é‡è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨<a href="./ziplist" class="internal">ziplist</a>,è¾ƒå¤šæ—¶ï¼Œä½¿ç”¨ <a href="./è·³è·ƒè¡¨" class="internal">è·³è·ƒè¡¨</a></p>
</blockquote>
<h2 id="èµ„æ–™">èµ„æ–™<a aria-hidden="true" tabindex="-1" href="#èµ„æ–™" class="internal"> Â§</a></h2>
<p><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/Redis%20%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98/06%20%20%E4%BB%8Eziplist%E5%88%B0quicklist%EF%BC%8C%E5%86%8D%E5%88%B0listpack%E7%9A%84%E5%90%AF%E5%8F%91.md" class="external">06 ä»zipliståˆ°quicklistï¼Œå†åˆ°listpackçš„å¯å‘</a></p></article></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xmlSpace="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li><a href="./redis-list" class="internal">redis-list</a></li><li><a href="./redis-åº•å±‚æ•°æ®ç»“æ„" class="internal">redis-åº•å±‚æ•°æ®ç»“æ„</a></li><li><a href="./ziplist" class="internal">ziplist</a></li><li><a href="./è·³è·ƒè¡¨" class="internal">è·³è·ƒè¡¨</a></li></ul></div></div></div><footer><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.0.10</a>, Â© 2023</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></body><script type="application/javascript">// quartz/components/scripts/quartz/components/scripts/callout.inline.ts
function toggleCallout() {
  const outerBlock = this.parentElement;
  outerBlock.classList.toggle(`is-collapsed`);
  const collapsed = outerBlock.classList.contains(`is-collapsed`);
  const height = collapsed ? this.scrollHeight : outerBlock.scrollHeight;
  outerBlock.style.maxHeight = height + `px`;
  let current = outerBlock;
  let parent = outerBlock.parentElement;
  while (parent) {
    if (!parent.classList.contains(`callout`)) {
      return;
    }
    const collapsed2 = parent.classList.contains(`is-collapsed`);
    const height2 = collapsed2 ? parent.scrollHeight : parent.scrollHeight + current.scrollHeight;
    parent.style.maxHeight = height2 + `px`;
    current = parent;
    parent = parent.parentElement;
  }
}
function setupCallout() {
  const collapsible = document.getElementsByClassName(
    `callout is-collapsible`
  );
  for (const div of collapsible) {
    const title = div.firstElementChild;
    if (title) {
      title.removeEventListener(`click`, toggleCallout);
      title.addEventListener(`click`, toggleCallout);
      const collapsed = div.classList.contains(`is-collapsed`);
      const height = collapsed ? title.scrollHeight : div.scrollHeight;
      div.style.maxHeight = height + `px`;
    }
  }
}
document.addEventListener(`nav`, setupCallout);
window.addEventListener(`resize`, setupCallout);
</script><script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
          const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
          mermaid.initialize({
            startOnLoad: false,
            securityLevel: 'loose',
            theme: darkMode ? 'dark' : 'default'
          });
          document.addEventListener('nav', async () => {
            await mermaid.run({
              querySelector: '.mermaid'
            })
          });
          </script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>